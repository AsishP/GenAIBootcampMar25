<!doctype html>
<head>
    <title>Hello AI Bootcamp</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/master.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<html>
   <body>
    <style >
      .img-fluid {
        max-width: 50%;
        height: auto;
      }
    </style>
     <main>
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#">Global AI Bootcamp</a>
          <div class="collapse navbar-collapse justify-content-right" id="navbarColor01">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Features</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Contact</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About</a>
          </li>
        </ul>
          </div>
        </div>
      </nav>
      <br />
      <!-- <div class="row featurette justify-content-center px-3">
        <div class="col-md-7 order-md-2">
          <h2 class="featurette-heading">Get Creative with AI: Vision and Speech</h2>
          <p class="lead">Demo</p>
        </div>
        <div class="col-md-3 order-md-1">
          <img class="d-block mx-auto mb-4" src="{{ url_for('static', filename='images/CreativewithAI.jpeg') }}" alt="Azure Logo" width="300" height="300"/>
        </div>
      </div> -->
      <div class="header-small row featurette justify-content-center px-3 headerbackground">
        <div class="col-md-7 order-md-2 layer">
          <h2 class="featurette-heading">Get Creative with AI: Vision and Speech</h2>
          <p class="lead">Demo</p>
        </div>
        <div class="col-md-3 order-md-1">
            <span>&nbsp;</span>
        </div>
      </div>  
      <hr class="featurette-divider">
      <div class="container mt-10">
        <h4 class="text-center">Expand the horizon of AI with Speech Analysis</h4>
      </div>
      <div class="container mt-10" style="max-width: 80%;">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link {% if tabselected == 'speech-transcription' %}active{% endif %}" id="speech-transcription-tab" data-toggle="tab" href="#speech-transcription" role="tab" aria-controls="speech-transcription" aria-selected="{% if active == 'speech-transcription' %}true{% else %}false{% endif %}">Speech Transcription</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link {% if tabselected == 'speech-analysis' %}active{% endif %}" id="speech-analysis-tab" data-toggle="tab" href="#speech-analysis" role="tab" aria-controls="speech-analysis" aria-selected="{% if active == 'speech-analysis' %}true{% else %}false{% endif %}">Speech Analysis</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link {% if tabselected == 'realtime-audio' %}active{% endif %}" id="realtime-audio-tab" data-toggle="tab" href="#realtime-audio" role="tab" aria-controls="realtime-audio" aria-selected="{% if active == 'realtime-audio' %}true{% else %}false{% endif %}">Realtime-Audio</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade {% if tabselected == 'speech-transcription' %}show active{% endif %}" id="speech-transcription" role="tabpanel" aria-labelledby="speech-transcription-tab">
            <div class="container mt-3"></div>
              <div class="row">
                <div class="col-md-3 align-items-center">
                  <h3>Audio Playback</h3>
                  <audio id="audioPlayer" controls>
                    <source src="{{ url_for('static', filename='audio/wikipediaOcelot.wav') }}" type="audio/wav">
                    Your browser does not support the audio element.
                  </audio>
                </div>
                <div class="col-md-9">
                    <h3>Speech Transcription</h3>
                    <div class="form-group container mt-3">
                      <button class="btn btn-primary" id="translateButton">Translate</button>
                    </div>
                    <div class="container mt-3" id="speechtranscriptionprogressBarContainer" style="display: none;">
                      <div class="alert alert-info" role="alert">
                      <strong>Processing...</strong> Please wait while we analyze the audio provided.
                      <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="speechtranscriptionprogressbar" style="width: 50%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>        
                    </div>
                    <div class="d-flex justify-content-center">
                      <img src="{{ url_for('static', filename='images/progress-question.gif') }}" alt="Progress" class="img-fluid mt-3" width="100" height="100" />
                    </div></div>
                  </div>
                    <div class="container mt-3">
                      {% if speechtranscriptionresult %}
                        <textarea id="dynamicLabel" class="shadow p-3 mb-5 bg-white rounded" style="min-width: 90%; display: block;" rows="10" readonly placeholder="Analysis Result">{{ speechtranscriptionresult }}</textarea>
                        <script type="text/javascript">speechtranslationprocessingDone();</script>
                      {% else %}
                        <textarea id="dynamicLabel" class="shadow p-3 mb-5 bg-white rounded" style="min-width: 90%; display: block;" rows="10" readonly placeholder="Analysis Result"></textarea>
                      {% endif %}
                  </div>
                </div>
                <script type="text/javascript">
                  var isTranslationProcessing = false; // Set to false when processing is done
        
                    function toggleSpeechTranslationProgressBar() {
                    var speechtranscriptionprogressBarContainer = document.getElementById('speechtranscriptionprogressBarContainer');
                    var speechtranscriptionprogressbar = document.getElementById('speechtranscriptionprogressbar');
                    if (isTranslationProcessing) {
                      speechtranscriptionprogressBarContainer.style.display = 'block';
                    } else {
                      progressBar.style.width = '100%';
                      setTimeout(function() {
                      speechtranscriptionprogressBarContainer.style.display = 'none';
                      }, 2000); // Delay hiding to allow the progress bar to reach 100%
                    }
                    }
        
                  // Call this function to hide the progress bar when processing is done
                   function speechtranslationprocessingDone() {
                    isTranslationProcessing = false;
                    toggleSpeechTranslationProgressBar();
                  }
        
                  document.getElementById('translateButton').addEventListener('click', function() {
                    isTranslationProcessing = true;
                    toggleSpeechTranslationProgressBar();
                    var url = "{{ url_for('speechtotext', tabselected='speech-transcription') }}";
                    window.location.href = url;
                  });
                 
                </script>
              </div>
            </div>
          </div>
          <div class="tab-pane fade {% if tabselected == 'speech-analysis' %}show active{% endif %}" id="speech-analysis" role="tabpanel" aria-labelledby="speech-analysis-tab">
            <div class="container mt-3"></div>
              <div class="row">
                <div class="col-md-3 align-items-center">
                  <h3>Audio Playback</h3>
                  <audio id="audioPlayer" controls>
                    <source src="{{ url_for('static', filename='audio/EarningsCall.wav') }}" type="audio/wav">
                    Your browser does not support the audio element.
                  </audio>
                </div>
                <div class="col-md-9">
                    <h3>Speech Analysis</h3>
                    <div class="form-group">
                      <label for="userInput">Question</label>
                      <div class="input-group">
                        <input type="text" class="form-control" id="speechanalysisInput" placeholder="Enter your question" aria-label="Speech Analysis Input">
                        <div class="input-group-append">
                        <button class="btn btn-primary" type="button" id="submitAnalysisButton">Submit</button>
                        </div>
                      </div>
                    </div>
                    <div class="container mt-3" id="speechanalysisprogressBarContainer" style="display: none;">
                      <div class="alert alert-info" role="alert">
                      <strong>Processing...</strong> Please wait while we analyze the audio provided.
                      <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="speechanalysisprogressbar" style="width: 50%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>        
                    </div>
                    <div class="d-flex justify-content-center">
                      <img src="{{ url_for('static', filename='images/progress-question.gif') }}" alt="Progress" class="img-fluid mt-3" width="100" height="100" />
                    </div></div>
                  </div>
                    <div class="container mt-3">
                      {% if speechanalysisresult %}
                        <textarea id="dynamicLabel" class="shadow p-3 mb-5 bg-white rounded" style="min-width: 90%; display: block;" rows="10" readonly placeholder="Analysis Result">{{ speechanalysisresult }}</textarea>
                        <script type="text/javascript">speechanalysisprocessingDone();</script>
                      {% else %}
                        <textarea id="dynamicLabel" class="shadow p-3 mb-5 bg-white rounded" style="min-width: 90%; display: block;" rows="10" readonly placeholder="Analysis Result"></textarea>
                      {% endif %}
                  </div>
                </div>
                <script type="text/javascript">
                    var isAnalysisProcessing = false; // Set to false when processing is done
              
                    function toggleSpeechAnalysisProgressBar() {
                    var speechanalysisprogressBarContainer = document.getElementById('speechanalysisprogressBarContainer');
                    var speechanalysisprogressbar = document.getElementById('speechanalysisprogressbar');
                    if (isAnalysisProcessing) {
                      speechanalysisprogressBarContainer.style.display = 'block';
                    } else {
                      progressBar.style.width = '100%';
                      setTimeout(function() {
                      speechanalysisprogressBarContainer.style.display = 'none';
                      }, 2000); // Delay hiding to allow the progress bar to reach 100%
                    }
                    }
              
                    // Call this function to hide the progress bar when processing is done
                     function speechanalysisprocessingDone() {
                    isAnalysisProcessing = false;
                    toggleSpeechAnalysisProgressBar();
                    }
              
                    document.getElementById('submitAnalysisButton').addEventListener('click', function() {
                    isAnalysisProcessing = true;
                    toggleSpeechAnalysisProgressBar();
                    
                    var queries = [];
                    var userInput = document.getElementById('speechanalysisInput').value;
                    queries.push(userInput);

                    var url = "{{ url_for('speechqueries', tabselected='speech-transcription') }}";
                    fetch(url, {
                      method: 'POST',
                      headers: {
                      'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({ queries: queries })
                    }).then(response => {
                      if (response.ok) {
                      return response.json();
                      }
                      throw new Error('Network response was not ok.');
                    }).then(data => {
                      console.log(data);
                    }).catch(error => {
                      console.error('There was a problem with the fetch operation:', error);
                    });
                    window.location.href = url;
                    });
                 
                </script>
              </div>
            </div>  
          </div>
          <div class="tab-pane fade {% if tabselected == 'speech-analysis' %}show active{% endif %}" id="video-analysis" role="tabpanel" aria-labelledby="video-analysis-tab">
            <div class="container mt-3">
              <h3>Video Analysis</h3>
              <p>This is a placeholder for the Video analysis</p>
            </div>
          </div>
        </div>
      </div>
     </main>   
     <!-- Include jQuery and Bootstrap JS -->
     <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>   
   </body>
</html>